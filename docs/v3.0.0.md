<br/>

<!-- tabs:start -->

#### **[ 配置 ]AuthorizationOptions**

```csharp
public class AuthorizationOptions
{
    
     # [ 拦截 ] 针对 PassThroughAuthorizationHandler 验证失败：是否继续后续验证
     public bool InvokeHandlersAfterFailure { get; set; } = true;
    
     # [ 策略组 ]
     /*... 代码忽略 ...*/
     
}


```



#### **[ ☢ 授权服务 ]IAuthorizationService**

>[!WARNING|style: flat|label: 简要说明 ]
>
>- <span style='color:Blue'>[ 授权结果 ]</span>
>
>```csharp
>public class AuthorizationResult
>{
>      
>       // [ 授权成功 ]
>       private static readonly AuthorizationResult _succeededResult = new() { Succeeded = true };
>       public static AuthorizationResult Success() => _succeededResult;
>       public bool Succeeded { get; }
>    
>       // [ 授权失败 ]
>       private static readonly AuthorizationResult _failedResult = new() { Failure = AuthorizationFailure.ExplicitFail() };
>       public static AuthorizationResult Failed() => _failedResult;
>       public AuthorizationFailure? Failure { get; private set; }
>   
>}
>
>
>```
>
>
>
><br/>

```csharp
// [ 请求授权 ]
public interface IAuthorizationService
{

      Task<AuthorizationResult> AuthorizeAsync(ClaimsPrincipal user, // [ 授权用户 ]
                                               object? resource, 
                                               IEnumerable<IAuthorizationRequirement> requirements);
      
}


```

```csharp
public class DefaultAuthorizationService : IAuthorizationService
{

      private readonly AuthorizationOptions _options;
      # [ 策略驱动 ]
      private readonly PassThroughAuthorizationHandler _handler; 

      public DefaultAuthorizationService(IOptions<AuthorizationOptions> options,
                                         PassThroughAuthorizationHandler _handler);
      
      public virtual async Task<AuthorizationResult> AuthorizeAsync(ClaimsPrincipal user, 
                                                                    object? resource, 
                                                                    IEnumerable<IAuthorizationRequirement> requirements)
      {

            # [ A ] 构建上下文
            AuthorizationHandlerContext authContext = new AuthorizationHandlerContext(requirements, resource, user);
            # [ B ] [ 策略驱动 - 循环验证 ]
            await this._handler.HandleAsync(authContext)
                               .ConfigureAwait(false);
            
            # [ C ] 返回验证结果
            return context.HasSucceeded ? AuthorizationResult.Success()
                                        : AuthorizationResult.Failed();
            
      }
      
}


```



<!-- tabs:end -->

