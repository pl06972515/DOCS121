<br/>

>[!WARNING|style: flat|label: ç®€è¦è¯´æ˜ ]
>
>[`NuGet - RabbitMQ.Client`] [<span style='color:#008B00'>[ğŸ‘“ å®˜æ–¹è¯´æ˜ ]</span>](https://www.rabbitmq.com/client-libraries/dotnet-api-guide#limitations ':target=_blank')
>
>(`RabbitMQ`) å®˜æ–¹å»ºè®®è¿æ¥ç®¡ç†å¦‚ä¸‹ï¼š
>
>- <span style='color:red'>[`Connection`å•ä¾‹æ¨¡å¼ - çº¿ç¨‹å®‰å…¨ ]</span> åº”ç”¨ç¨‹åºåº”åœ¨å¯åŠ¨æ—¶å»ºç«‹è¿æ¥ [ åº”åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¤ç”¨è¯¥è¿æ¥ ]
>
>- <span style='color:red'>[`RabbitMQ`ä¸­çš„`Channel`æ˜¯`AMQP`åè®®ä¸­çš„è™šæ‹Ÿè¿æ¥ï¼Œéçº¿ç¨‹å®‰å…¨ï¼šæ¯ä¸ª`Channel`éƒ½æœ‰è‡ªå·±çš„çŠ¶æ€å’Œç¼“å†²åŒº ]</span> 
>
>   <span style='color:red'>[ å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ª`Channel`ï¼Œä¼šå¯¼è‡´åè®®å¸§äº¤é”™(`frame interleaving`) - ä»è€Œå¼•å‘ä¸¥é‡çš„åè®®é”™è¯¯ ]</span>
>
>
><br/>
>
><span style='color:Blue'>[ æœ€ä½³å®è·µ ]</span>
>
>- å‘å¸ƒæ¶ˆæ¯ï¼šæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹`Channel`
>
>- æ¶ˆè´¹æ¶ˆæ¯ï¼šå°½é‡ç‹¬ç«‹`Channel`<span style='color:red'>[ å¿…é¡»å…±äº«æ—¶ç”¨äº’æ–¥ ]</span>
>
>   <span style='color:red'>[ æ¨èç”¨å¯¹è±¡æ± ï¼šæ¯æ¬¡ä»æ± ä¸­è·å–`Channel`ï¼Œç”¨å®Œå½’è¿˜ï¼Œä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨æŸä¸ª`Channel`]</span>
>
>   <span style='color:red'>[ æ³¨æ„äº‹é¡¹ï¼šå› `Connection`è¿æ¥ä¸­æ–­ï¼Œæ‰€æœ‰åŸºäºè¯¥è¿æ¥åˆ›å»ºçš„`Channel`éƒ½ä¼šå¤±æ•ˆï¼Œæ— æ³•ç»§ç»­ä½¿ç”¨ ]</span>
>
>
><br/>

<!-- tabs:start -->

#### **[ å•ä¾‹ ]IConnection**

```csharp
# connstr: amqp://user:pass@hostName:port/vhost
ConnectionFactory factory = new ConnectionFactory();
// factory.HostName = "192.168.8.172";
// factory.VirtualHost = "/";
# é»˜è®¤AMQPç«¯å£ï¼ˆ éç®¡ç†ç«¯å£ ï¼‰
factory.Port = 5672;
factory.UserName = "root";
factory.Password = "888888";

# [ è¿æ¥è¶…æ—¶æ—¶é—´ ] å»ºè®®è®¾ç½®ä¸º10~30ç§’
factory.RequestedConnectionTimeout = TimeSpan.FromSeconds(15);
# [ è¿æ¥å¿ƒè·³é—´éš” ] å»ºè®®è®¾ç½®ä¸º 30ç§’æˆ–æ›´çŸ­ ( é˜²æ­¢è¿æ¥å‡æ­» - é»˜è®¤ 1 åˆ†é’Ÿ )
factory.RequestedHeartbeat = TimeSpan.FromSeconds(30);

factory.AutomaticRecoveryEnabled = true;                    // [ è‡ªåŠ¨æ¢å¤è¿æ¥ ]
factory.NetworkRecoveryInterval = TimeSpan.FromSeconds(10); // æ¯ 10 ç§’å°è¯•ä¸€æ¬¡è‡ªåŠ¨æ¢å¤

# [ è¯»å†™è¶…æ—¶æ—¶é—´ ]
factory.SocketReadTimeout = TimeSpan.FromSeconds(15);
factory.SocketWriteTimeout = TimeSpan.FromSeconds(15);

var endpoints = new System.Collections.Generic.List<AmqpTcpEndpoint> {
    new AmqpTcpEndpoint("192.168.8.172")
};
IConnection conn = await factory.CreateConnectionAsync(endpoints);

// await conn.CloseAsync();
// await conn.DisposeAsync();


```



#### **[ â˜¢ é€šé“ ]IChannel **

```csharp
public class ChannelPooledObjectPolicy : PooledObjectPolicy<IChannel>
{

     private readonly IConnection _connection;
     public ChannelPooledObjectPolicy(IConnection connection)
     {
          _connection = connection;
     }

     public override IChannel Create()
     {
          var channel = _connection.CreateChannelAsync().GetAwaiter().GetResult();
          return channel;
     }

     public override bool Return(IChannel obj)
     {
         
          # [ å½’è¿˜æ‰“å¼€çš„é€šé“ ] è¶…å‡ºå¯¹è±¡å®¹å™¨ï¼šè‡ªåŠ¨ IDisposable
          // await channel.CloseAsync();
          // await channel.DisposeAsync();
          return obj.IsOpen;
         
     }
     
}


```

```csharp
IConnection conn = await factory.CreateConnectionAsync(endpoints);
DefaultObjectPool<IChannel> pool = new DefaultObjectPool<IChannel>(new ChannelPooledObjectPolicy(conn));

IChannel channel = pool.Get();
try
{
     Console.WriteLine("é€šé“æ˜¯å¦æ­£å¸¸æ‰“å¼€ï¼š" + channel.IsOpen);
}
finally
{

     pool.Return(channel);
}

channel = pool.Get();
try
{
     Console.WriteLine("é€šé“æ˜¯å¦æ­£å¸¸æ‰“å¼€ï¼š" + channel.IsOpen);
}
finally
{

     pool.Return(channel);
}


```





<!-- tabs:end -->
