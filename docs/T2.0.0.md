<br/>

<!-- tabs:start -->

#### **[ ☢ 自定义权限 ] IAuthorizationRequirementData**

```csharp
/// <summary>
/// 1. [ 本类型 ] QQ 方式登陆
/// 2. [ 中间件 ] 禁止匿名访问 （因为指定策略 AuthorizeAttribute）
/// </summary>
public sealed class QQAuthorizeAttribute : AuthorizeAttribute, 
                                           IAuthorizationRequirementData
{
                                               
     public IEnumerable<IAuthorizationRequirement> GetRequirements()
     {
          yield return new QQAuthorizationHandler();
     }

}


```

```csharp
public sealed class QQAuthorizationHandler : AuthorizationHandler<QQAuthorizationHandler>,
                                             IAuthorizationRequirement

{
                                                 
      protected override Task HandleRequirementAsync(AuthorizationHandlerContext context, QQAuthorizationHandler requirement)
      {

           HttpContext? httpContent = context.Resource as HttpContext;
           if (httpContent.User != null && httpContent.User.Identities.All(x => x.IsAuthenticated)) {
               if(context.User!.Identity!.AuthenticationType == "QQ")
                   context.Succeed(requirement);

           }
          
           return Task.CompletedTask;

      }
                                                 
}


```



#### **请求认证**

```csharp
var builder = WebApplication.CreateBuilder(args);
// [ 注册 ] 请求认证
builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
                .AddCookie(options =>
                 {
                      options.LoginPath = new PathString("/Login");
                      options.ExpireTimeSpan = TimeSpan.FromMinutes(30);
                      options.SlidingExpiration = true;

                 });
// [ 注册 ] 请求鉴权
builder.Services.AddAuthorization();


```

```csharp
var app = builder.Build();

#region 账号登陆

app.MapGet("/Login", (HttpContext context) =>
{

      var identity = new GenericIdentity("1001", "QQ");
      GenericPrincipal principal = new GenericPrincipal(identity, ["admin"]);
      context.SignInAsync(principal, new AuthenticationProperties
      {
           RedirectUri = new PathString("/Home")
      });

});

#endregion

app.MapGet("/Home", [QQAuthorize] async (ClaimsPrincipal? principal, HttpContext context) =>
{

});

await app.RunAsync();


```



<!-- tabs:end -->













