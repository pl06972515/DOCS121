<br/>

<!-- tabs:start -->

#### **[ 策略组 ]AuthorizationPolicy**

!> <span style='color:Blue'>[ 策略组 ]</span> <span style='color:red'>预先注册一组策略，在需要时 [ 根据注册的名称 → 提取对应的策略组 ]</span>

```csharp
public class AuthorizationPolicy
{

      # [ 权限集合 ] IAuthorizationRequirement
      public IReadOnlyList<IAuthorizationRequirement> Requirements { get; } 
      public AuthorizationPolicy(IEnumerable<IAuthorizationRequirement> requirements);
      
}


```

```csharp
# [ 建筑者 ]
public class AuthorizationPolicyBuilder
{
    
      // [ 本组：认证集合 ]
      public IList<IAuthorizationRequirement> Requirements { get; set; } = new List<IAuthorizationRequirement>();
    
      // [ 添加 ] 自定义权限
      public AuthorizationPolicyBuilder AddRequirements(params IAuthorizationRequirement[] requirements)
      {
           foreach (var req in requirements)
               this.Requirements.Add(req);
           return this;
      }
    
      #region [ 预设 ] 权限策略
      
      // [ A ] 质询拒绝
      public AuthorizationPolicyBuilder RequireAuthenticatedUser()
      {
           this.Requirements.Add(new DenyAnonymousAuthorizationRequirement());
           return this;
      }
    
      // [ B ] 指定声明
      public AuthorizationPolicyBuilder RequireClaim(string claimType, params string[] allowedValues)
      {
           this.Requirements.Add(new ClaimsAuthorizationRequirement(claimType, allowedValues));
           return this;
      }
    
      // [ C ] 指定角色
      public AuthorizationPolicyBuilder RequireRole(params string[] roles)
      {
           this.Requirements.Add(new RolesAuthorizationRequirement(roles));
           return this;
      }
    
      // [ D ] 指定账号
      public AuthorizationPolicyBuilder RequireUserName(string userName)
      {
           this.Requirements.Add(new NameAuthorizationRequirement(userName));
           return this;
      }
    
      #endregion
      
      public AuthorizationPolicy Build()
          => return new AuthorizationPolicy(this.Requirements);
          
}


```



#### **[ ☢ 外附配置项 ]Options**

```csharp
public class AuthorizationOptions
{
     
     public Dictionary<string, Task<AuthorizationPolicy?>> PolicyMap { get; } 
             = new Dictionary<string, Task<AuthorizationPolicy?>>(StringComparer.OrdinalIgnoreCase);
     
     # [ 默认策略 ] 质询拒绝 ( 无权访问 - 状态码 403 )
     public AuthorizationPolicy DefaultPolicy { get; set; } 
            = new AuthorizationPolicyBuilder()
             .RequireAuthenticatedUser()
             .Build();
     
     # [ 全局策略 ] 默认 NULL
     public AuthorizationPolicy? FallbackPolicy { get; set; }
    
     # [ 自定义策略 ] 
     public void AddPolicy(string name, Action<AuthorizationPolicyBuilder> configurePolicy)
     {
          var policyBuilder = new AuthorizationPolicyBuilder();
          configurePolicy(policyBuilder);
          this.PolicyMap[name] = Task.FromResult<AuthorizationPolicy?>(policyBuilder.Build());
     }
     
     /*... 代码忽略 ...*/
    
}


```



<!-- tabs:end -->



